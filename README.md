# VSCode SVN 插件

这是一个为Visual Studio Code开发的SVN（Subversion）版本控制系统集成插件，旨在提供全面的SVN操作功能，使开发者能够直接在VSCode中进行SVN相关操作。

## 功能特性

### 基础功能
- [ ] SVN仓库初始化与检出
- [ ] 文件状态显示（修改、添加、删除等）
- [x] 提交更改（文件上传）
- [x] 文件差异对比和提交
- [x] 更新工作副本（文件、目录和工作区）
- [ ] 查看文件历史记录
- [ ] 比较文件差异

### 高级功能
- [ ] 分支管理
- [ ] 合并操作
- [ ] 冲突解决
- [ ] 标签管理
- [ ] 锁定/解锁文件
- [ ] 属性管理
- [ ] 忽略文件配置
- [x] 自定义SVN工作副本路径
- [x] 编码问题处理
- [x] AI生成提交日志

### 用户界面
- [ ] SVN资源管理器视图
- [ ] 状态栏集成
- [ ] 命令面板集成
- [x] 上下文菜单集成（右键菜单）
- [x] 差异对比和提交界面（左右对比视图）

## 使用方法

### 安装
1. 确保您的系统已安装SVN命令行工具
2. 在VSCode扩展市场中搜索"VSCode SVN"并安装
3. 重启VSCode

### 文件上传
1. 在资源管理器中右键点击文件
2. 选择"SVN: 上传文件"
3. 输入提交信息
4. 文件将被添加到SVN（如果尚未添加）并提交

### 文件夹上传
1. 在资源管理器中右键点击文件夹
2. 选择"SVN: 上传文件夹"
3. 选择是否添加未版本控制的文件
4. 输入提交信息
5. 文件夹中的更改将被提交到SVN

### 文件差异对比和提交
1. 在资源管理器中右键点击文件
2. 选择"SVN: 提交文件(显示差异)"
3. 如果文件未在SVN控制下，会询问是否添加到SVN
4. 系统会打开一个左右对比界面，左侧显示SVN版本，右侧显示工作副本
5. 在界面底部输入提交日志
6. 点击"提交"按钮完成提交（如果文件有差异，提交按钮才可点击）
7. 您也可以点击"使用AI生成提交日志"按钮，自动生成基于文件差异的提交日志

### AI生成提交日志
1. 在提交界面中，点击"使用AI生成提交日志"按钮
2. 系统会分析文件差异，并使用AI生成一个专业的提交日志
3. 生成的提交日志会自动填充到提交日志文本框中
4. 您可以直接使用生成的日志，或根据需要进行修改后提交
5. 首次使用时，系统会提示您设置API密钥

### 设置AI模型和API密钥
1. 打开VSCode设置（文件 > 首选项 > 设置）
2. 搜索"vscode-svn.aiModel"，选择要使用的AI模型（OpenAI 或 通义千问）
3. 如果选择OpenAI：
   - 搜索"vscode-svn.aiApiKey"
   - 输入您的OpenAI API密钥
4. 如果选择通义千问：
   - 搜索"vscode-svn.qwenApiKey"
   - 输入您的通义千问API密钥（在通义千问控制台获取）
5. 您也可以在首次使用AI生成提交日志功能时，根据提示设置相应的密钥

### 更新文件
1. 在资源管理器或编辑器中右键点击文件
2. 选择"SVN: 更新文件"
3. 如果文件有本地修改，系统会询问是否继续更新
4. 更新完成后，如果文件已在编辑器中打开，内容会自动刷新

### 更新目录
1. 在资源管理器中右键点击文件夹
2. 选择"SVN: 更新目录"
3. 系统会打开一个更新面板，显示更新进度和结果
4. 更新完成后，面板会显示所有更新的文件列表和状态
5. 您可以点击"重新更新"按钮再次更新，或点击"关闭"按钮关闭面板

### 更新工作区
1. 打开命令面板（按下`F1`或`Ctrl+Shift+P`）
2. 执行"SVN: 更新工作区"命令
3. 系统会更新整个工作区（当前打开的项目）
4. 更新面板会显示所有更新的文件列表和状态

### 设置SVN工作副本路径

如果您的文件不在标准的SVN工作副本结构中，或者需要将文件关联到特定的SVN仓库，可以手动设置SVN工作副本路径：

1. 在资源管理器中右键点击任意文件或文件夹
2. 选择 "SVN: 设置SVN工作副本路径"
3. 在弹出的对话框中选择包含`.svn`目录的SVN工作副本根目录
4. 设置成功后，插件将使用该路径作为SVN工作副本根目录

您也可以通过命令面板（按下`F1`或`Ctrl+Shift+P`）执行"SVN: 设置SVN工作副本路径"命令。

### 清除SVN工作副本路径设置

如果需要清除之前设置的自定义SVN工作副本路径：

1. 打开命令面板（按下`F1`或`Ctrl+Shift+P`）
2. 执行"SVN: 清除SVN工作副本路径"命令

### 编码问题处理

本插件针对SVN操作中可能出现的编码问题进行了特殊处理：

1. 设置了环境变量以确保SVN命令使用UTF-8编码
2. 对于差异比较，添加了`--force`和其他参数以处理特殊字符
3. 当标准差异比较失败时，会提供备用方法显示文件变化
4. 即使在无法显示详细差异的情况下，也能继续进行提交操作

如果您在使用过程中仍然遇到编码问题，可以尝试：
- 确保您的SVN客户端配置为使用UTF-8编码
- 在SVN配置文件中设置`svn:mime-type`属性为`text/plain;charset=UTF-8`
- 对于特殊文件，可以直接使用"SVN: 上传文件"命令而不查看差异

## 注意事项

- 请确保系统已安装SVN命令行工具
- 文件必须位于SVN工作副本中，或者已通过"设置SVN工作副本路径"功能关联到SVN工作副本
- 请确保您有足够的权限执行SVN操作
- 对于包含特殊字符或二进制文件，差异比较可能无法正常显示，但仍可以提交

## 开发计划

### 第一阶段：基础功能实现（当前）
- [x] 实现基本的SVN命令包装
- [x] 实现文件差异对比功能
- [x] 实现基本的提交和更新功能
- [x] 修复编码问题，增强错误处理

### 第二阶段：用户界面优化
- [ ] 开发SVN资源管理器视图
- [ ] 实现状态栏集成
- [ ] 添加命令面板支持

### 第三阶段：高级功能开发
- [ ] 实现分支和合并功能
- [ ] 开发冲突解决工具
- [ ] 添加标签管理功能

## 修改记录

### 版本 0.1.0 (开发中)
- 初始项目结构设置
- 基本SVN命令封装
- 实现SVN文件上传功能
- 实现SVN文件夹上传功能
- 实现文件差异对比和提交界面
- 上下文菜单集成
- 添加自定义SVN工作副本路径功能
- 修复编码问题，增强错误处理
- 改进差异对比显示为左右对比视图
- 添加更新文件功能
- 添加更新目录和更新工作区功能，并显示更新信息
- 添加AI生成提交日志功能，自动分析差异并生成专业提交日志

## 技术栈
- TypeScript
- VS Code Extension API
- SVN命令行工具集成
- OpenAI API（用于生成提交日志）

## 贡献指南
欢迎提交问题报告和功能请求。如果您想贡献代码，请先开issue讨论您想要更改的内容。

## 许可证
[MIT](LICENSE) 